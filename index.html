<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2/20 é«˜é›„æªåœ˜ (æ™‚é–“å¯è®Šç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root { 
            --primary: #007bff; 
            --selected: #2c3e50;
            --bg-rush: #ffebee; --bd-rush: #ef5350;
            --bg-chill: #e8f5e9; --bd-chill: #66bb6a;
            --bg-food: #fff3e0; --bd-food: #ffa726;
            --bg-trans: #e3f2fd; --bd-trans: #2196f3;
        }
        
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background: #f4f7f6; margin: 0; padding: 0; padding-bottom: 120px; color: #333; }
        
        .nav { background: #333; padding: 15px; color: white; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav h1 { margin: 0; font-size: 1.2rem; }

        .container { max-width: 900px; margin: 0 auto; padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.1rem; color: #444; }

        /* ç¯©é¸å™¨ */
        .filter-bar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; }
        .filter-btn { white-space: nowrap; padding: 8px 15px; border: 1px solid #ddd; border-radius: 20px; background: white; cursor: pointer; transition: 0.2s; }
        .filter-btn.active { background: var(--selected); color: white; border-color: var(--selected); }

        /* æ™¯é»æ±  */
        .pool { 
            border: 2px dashed #bbb; min-height: 120px; max-height: 300px; overflow-y: auto;
            display: flex; flex-wrap: wrap; gap: 8px; align-content: flex-start;
            padding: 10px; background: #fafafa; border-radius: 8px; 
        }
        
        /* æ–¹å¡Šé€šç”¨æ¨£å¼ */
        .item { 
            padding: 8px 10px; border-radius: 6px; font-size: 0.9rem; 
            cursor: grab; display: inline-block; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); user-select: none; 
            background: white; border: 1px solid #eee; position: relative;
            transition: height 0.2s ease, background-color 0.2s;
            /* é è¨­é«˜åº¦ */
            height: auto; 
            min-height: 40px;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .item .content-row { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .item .district-tag { font-size: 0.7em; padding: 2px 4px; border-radius: 3px; background: rgba(0,0,0,0.1); margin-right: 5px; font-weight: bold; }
        .item small { display: block; font-size: 0.75em; opacity: 0.8; margin-top: 2px; }

        /* é¡è‰²åˆ†é¡ */
        .item.food { background: var(--bg-food); border-left: 5px solid var(--bd-food); }
        .item.tour { background: var(--bg-rush); border-left: 5px solid var(--bd-rush); }
        .item.chill { background: var(--bg-chill); border-left: 5px solid var(--bd-chill); }
        .item.trans { background: var(--bg-trans); border-left: 5px solid var(--bd-trans); font-weight: bold; width: 100%; }

        /* æ™‚é–“æ§åˆ¶åˆ— (åªæœ‰æ‹–å…¥è¡Œç¨‹è¡¨å¾Œæ‰é¡¯ç¤º) */
        .time-ctrl {
            display: none; /* é è¨­éš±è— */
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dashed rgba(0,0,0,0.1);
            font-size: 0.8rem;
            align-items: center;
            justify-content: space-between;
            color: #666;
        }
        .time-ctrl button {
            background: rgba(0,0,0,0.1); border: none; border-radius: 4px;
            width: 24px; height: 24px; cursor: pointer; font-weight: bold;
        }
        .time-ctrl button:hover { background: rgba(0,0,0,0.2); }
        
        /* ç•¶æ–¹å¡Šåœ¨è¡Œç¨‹è¡¨ä¸­æ™‚çš„ç‰¹æ®Šæ¨£å¼ */
        .slot-area .item { width: 100%; box-sizing: border-box; } 
        .slot-area .item .time-ctrl { display: flex; } /* é¡¯ç¤ºæ™‚é–“æ§åˆ¶å™¨ */

        /* æ™‚é–“è»¸èˆ‡è·¯é † */
        .time-slot-container { margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 8px; background: white; overflow: hidden; display: flex; }
        .time-label { 
            padding: 5px; background: #e3f2fd; color: #1565c0; 
            font-weight: bold; font-size: 0.85rem; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            width: 70px; flex-shrink: 0; text-align: center; border-right: 1px solid #ddd;
        }
        .slot-content { flex-grow: 1; display: flex; flex-direction: column; }
        
        .slot-area { 
            flex-grow: 1; padding: 8px; min-height: 60px; 
            display: flex; flex-direction: column; gap: 5px; /* å‚ç›´æ’åˆ— */
        }
        
        .route-hint { 
            font-size: 0.75rem; padding: 2px 10px; background: #f9f9f9; 
            border-top: 1px solid #eee; color: #888; text-align: right;
        }
        .hint-ok { color: #2e7d32; font-weight: bold; }
        .hint-warn { color: #c62828; font-weight: bold; }

        /* åº•éƒ¨æŒ‰éˆ• */
        .action-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 12px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; justify-content: center; gap: 15px; z-index: 999; }
        .btn-main { background: var(--primary); color: white; padding: 12px 25px; border-radius: 50px; border: none; font-size: 1rem; font-weight: bold; cursor: pointer; flex: 2; }
        .btn-reset { background: #90a4ae; color: white; padding: 12px 20px; border-radius: 50px; border: none; cursor: pointer; flex: 1; }

        .input-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
        .btn-opt { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; background: white; border-radius: 8px; text-align: left; cursor: pointer; }
        .btn-opt.active { background: var(--selected); color: white; border-color: var(--selected); }
    </style>
</head>
<body>

<div class="nav">
    <h1>ğŸš„ 2/20 é«˜é›„å…¨å€æ”»ç•¥ (æ™‚é–“ç‰ˆ)</h1>
</div>

<div class="container">

    <div class="card">
        <h2>1. ä½ çš„æš±ç¨± & å±¬æ€§</h2>
        <div class="input-group">
            <input type="text" id="username" placeholder="è«‹è¼¸å…¥æš±ç¨± (ä¾‹ï¼šè±ªè±ª)">
        </div>
        <div style="display: flex; gap:10px;">
            <div style="flex:1">
                <p><strong>Q1. é«”åŠ›?</strong></p>
                <button class="btn-opt" onclick="selectOpt(this, 'q1', 1)">A. ç‰¹ç¨®å…µ</button>
                <button class="btn-opt" onclick="selectOpt(this, 'q1', -1)">B. é¤Šç”Ÿåœ˜</button>
            </div>
            <div style="flex:1">
                <p><strong>Q2. å–œå¥½?</strong></p>
                <button class="btn-opt" onclick="selectOpt(this, 'q2', 1)">A. æˆ¶å¤–</button>
                <button class="btn-opt" onclick="selectOpt(this, 'q2', -1)">B. å®¤å…§</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>2. åœ°åœ–åƒè€ƒ</h2>
        <iframe src="https://www.google.com/maps/d/u/0/embed?mid=1ZjcKfex88IRUfytr3WUMttoVmXFv0x0&ehbc=2E312F" style="width:100%; height:350px; border:0; border-radius:8px;"></iframe>
    </div>

    <div class="card">
        <h2>3. æ‹–æ‹‰æ’è¡Œç¨‹ (å¯èª¿æ™‚é–“é•·åº¦)</h2>
        <p style="font-size:0.9rem; color:#666;">å°‡æ–¹å¡Šæ‹–å…¥ä¸‹æ–¹ï¼Œä¸¦ä½¿ç”¨ +/- èª¿æ•´åœç•™æ™‚é–“ã€‚</p>
        
        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterSpots('all')">å…¨éƒ¨</button>
            <button class="filter-btn" onclick="filterSpots('äº¤é€š')">äº¤é€š</button>
            <button class="filter-btn" onclick="filterSpots('é¹½åŸ•å€')">é¹½åŸ•å€</button>
            <button class="filter-btn" onclick="filterSpots('é¼“å±±å€')">é¼“å±±å€</button>
            <button class="filter-btn" onclick="filterSpots('å·¦ç‡Ÿå€')">å·¦ç‡Ÿå€</button>
            <button class="filter-btn" onclick="filterSpots('å‰é‡‘å€')">å‰é‡‘å€</button>
            <button class="filter-btn" onclick="filterSpots('æ–°èˆˆå€')">æ–°èˆˆå€</button>
            <button class="filter-btn" onclick="filterSpots('å‰é®å€')">å‰é®å€</button>
            <button class="filter-btn" onclick="filterSpots('ä¸‰æ°‘å€')">ä¸‰æ°‘å€</button>
            <button class="filter-btn" onclick="filterSpots('è‹“é›…å€')">è‹“é›…å€</button>
            <button class="filter-btn" onclick="filterSpots('é³³å±±å€')">é³³å±±å€</button>
        </div>

        <div id="pool" class="pool">
            </div>
    </div>

    <div class="card">
        <h3>ç•¶æ—¥è¡Œç¨‹è¡¨ (08:00 - 22:00)</h3>
        <div id="schedule-container"></div>
    </div>

</div>

<div class="action-bar">
    <button class="btn-reset" onclick="location.reload()">é‡ç½®</button>
    <button class="btn-main" onclick="generateReport()">è¤‡è£½çµæœ (è²¼Line)</button>
</div>

<script>
    // --- è³‡æ–™åº«ï¼šåŠ å…¥å®¢é‹è³‡è¨Š ---
    const allSpots = [
        // äº¤é€š (æ–°å¢å®¢é‹)
        { name: "å’Œæ¬£å®¢é‹(å»)", district: "äº¤é€š", type: "trans", note: "09:32 æ–°ç‡Ÿ-å»ºåœ‹" },
        { name: "å’Œæ¬£å®¢é‹(å»)", district: "äº¤é€š", type: "trans", note: "09:47 éº»è±†-å»ºåœ‹" },
        { name: "ç«è»Š(å»):è‡ªå¼·161", district: "äº¤é€š", type: "trans", note: "09:30æ–°ç‡Ÿ-10:18é«˜é›„" },
        { name: "ç«è»Š(å»):å€å¿«1003", district: "äº¤é€š", type: "trans", note: "09:44æ–°ç‡Ÿ-10:48æ–°å·¦ç‡Ÿ" },
        { name: "ç«è»Š(å›):è‡ªå¼·196", district: "äº¤é€š", type: "trans", note: "20:28æ–°å·¦ç‡Ÿ-21:18æ–°ç‡Ÿ" },
        { name: "ç«è»Š(å›):è‡ªå¼·156", district: "äº¤é€š", type: "trans", note: "21:18æ–°å·¦ç‡Ÿ-22:17æ–°ç‡Ÿ" },
        { name: "æ·é‹/è¼•è»Œç§»å‹•", district: "äº¤é€š", type: "trans", note: "" },

        // å·¦ç‡Ÿå€
        { name: "å¯¬ä¾†é †æ—©é¤åº—", district: "å·¦ç‡Ÿå€", type: "food" },
        { name: "é¾å¸¥æ¹¯åŒ…éºµé¤¨", district: "å·¦ç‡Ÿå€", type: "food" },
        { name: "æ­£å®—é´¨è‚‰é£¯", district: "å·¦ç‡Ÿå€", type: "food" },
        { name: "å·¦ç‡Ÿè»å€æ•…äº‹é¤¨", district: "å·¦ç‡Ÿå€", type: "tour" },
        { name: "åŸç”Ÿæ¤ç‰©åœ’", district: "å·¦ç‡Ÿå€", type: "tour" },
        { name: "å†è¦‹æŒæŒé™¸çœ·æ‘", district: "å·¦ç‡Ÿå€", type: "tour" },
        { name: "è“®æ± æ½­ç’°æ¹–", district: "å·¦ç‡Ÿå€", type: "tour" },

        // é¼“å±±å€
        { name: "ä¸¹ä¸¹æ¼¢å ¡(è¥¿å­ç£)", district: "é¼“å±±å€", type: "food" },
        { name: "ç¢—å®¹å¥¶å¥¶å®¶", district: "é¼“å±±å€", type: "tour" },
        { name: "æœè²¿ç¤¾å€", district: "é¼“å±±å€", type: "tour" },
        { name: "å£½å±±æƒ…äººè§€æ™¯å°", district: "é¼“å±±å€", type: "tour" },
        { name: "å£½å±±å‹•ç‰©åœ’", district: "é¼“å±±å€", type: "tour" },
        { name: "è¥¿å­ç£éš§é“", district: "é¼“å±±å€", type: "tour" },
        { name: "æ‰“ç‹—è‹±åœ‹é ˜äº‹é¤¨", district: "é¼“å±±å€", type: "tour" },
        { name: "å‡¹å­åº•æ£®æ—å…¬åœ’", district: "é¼“å±±å€", type: "tour" },
        { name: "æ„›æ²³ä¹‹å¿ƒ", district: "é¼“å±±å€", type: "tour" },
        { name: "æ£§è²³åº«KW2", district: "é¼“å±±å€", type: "tour" },
        { name: "å¾¡å…¸èŒ¶(ç²‰è§’)", district: "é¼“å±±å€", type: "food" },
        { name: "ç‘è±å¤œå¸‚", district: "é¼“å±±å€", type: "food" },

        // æ——æ´¥å€
        { name: "é™³å®¶æ‰‹å·¥è‚‰åŒ…", district: "æ——æ´¥å€", type: "food" },
        { name: "æ——æ´¥ç¦¾å‘³è‚‰åœ“", district: "æ——æ´¥å€", type: "food" },
        { name: "æ–—å…­å†°åŸ", district: "æ——æ´¥å€", type: "food" },
        { name: "æ——æ´¥é¢¨è»Šå…¬åœ’", district: "æ——æ´¥å€", type: "tour" },
        { name: "æ——æ´¥å½©è™¹æ•™å ‚", district: "æ——æ´¥å€", type: "tour" },
        { name: "é«˜é›„æ¸¯å¤§æ¸¯æ©‹", district: "æ——æ´¥å€", type: "tour" },
        { name: "é«˜é›„ç‡ˆå¡”", district: "æ——æ´¥å€", type: "tour" },

        // é¹½åŸ•å€
        { name: "å¤§æºé ‚è™±ç›®é­šç±³ç²‰", district: "é¹½åŸ•å€", type: "food" },
        { name: "é´¨è‚‰æœ¬", district: "é¹½åŸ•å€", type: "food" },
        { name: "å†¬ç²‰ç‹", district: "é¹½åŸ•å€", type: "food" },
        { name: "é¦™æ¸¯ç™¼è²¡å°é¤¨", district: "é¹½åŸ•å€", type: "food" },
        { name: "åŒ—æ¸¯è”¡ä¸‰ä»£ç±³ç³•", district: "é¹½åŸ•å€", type: "food" },
        { name: "é¹½åŸ•å³å®¶é‡‘æ¡”è±†èŠ±", district: "é¹½åŸ•å€", type: "food" },
        { name: "åƒè²¨é£Ÿå®´å®¤", district: "é¹½åŸ•å€", type: "food" },
        { name: "é¹½åŸ•è€åº—å°åƒ", district: "é¹½åŸ•å€", type: "food" },
        { name: "é«˜æµéŸ³æ¨‚ä¸­å¿ƒ", district: "é¹½åŸ•å€", type: "tour" },
        { name: "å¤§æ¨¹å®‡å®™", district: "é¹½åŸ•å€", type: "tour" },
        { name: "é§äºŒè—è¡“ç‰¹å€", district: "é¹½åŸ•å€", type: "tour" },
        { name: "å¤§æºé ‚è€è¡—", district: "é¹½åŸ•å€", type: "tour" },
        { name: "æ„›æ²³è¦ªæ°´å¾’æ­¥å€", district: "é¹½åŸ•å€", type: "tour" },

        // å‰é‡‘å€
        { name: "å“æ·±æµ·é­šæ¹¯", district: "å‰é‡‘å€", type: "food" },
        { name: "å³è¨˜è‚‰åœ“", district: "å‰é‡‘å€", type: "food" },
        { name: "ç¾è¿ªäºæ¼¢å ¡", district: "å‰é‡‘å€", type: "food" },
        { name: "ã‚‰ãƒ¼ã‚ã‚“å£±", district: "å‰é‡‘å€", type: "food" },
        { name: "åŸå¸‚å…‰å»Š", district: "å‰é‡‘å€", type: "tour" },
        { name: "é«˜é›„ä¸»æ•™åº§å ‚", district: "å‰é‡‘å€", type: "tour" },
        { name: "æ¼¢ç¥ç™¾è²¨", district: "å‰é‡‘å€", type: "tour" },

        // ä»æ­¦å€
        { name: "ä»æ­¦çƒ¤é´¨", district: "ä»æ­¦å€", type: "food" },
        { name: "è˜‡è€çˆºå¤å‘³å‰µæ–°", district: "ä»æ­¦å€", type: "food" },

        // æ–°èˆˆå€
        { name: "éƒ­å®¶è‚‰ç‡¥é£¯", district: "æ–°èˆˆå€", type: "food" },
        { name: "è€ææ’éª¨é…¥æ¹¯", district: "æ–°èˆˆå€", type: "food" },
        { name: "é˜¿éœç‡’è‚‰é£¯", district: "æ–°èˆˆå€", type: "food" },
        { name: "é¦™å‘³æµ·ç”¢ç²¥", district: "æ–°èˆˆå€", type: "food" },
        { name: "å¤§åŸè€èˆ¹éºµ", district: "æ–°èˆˆå€", type: "food" },
        { name: "é™³è³£è³£é£¯ç³°", district: "æ–°èˆˆå€", type: "food" },
        { name: "è€æ±Ÿç´…èŒ¶ç‰›å¥¶", district: "æ–°èˆˆå€", type: "food" },
        { name: "æ–°å´›æ±Ÿå•†åœˆ", district: "æ–°èˆˆå€", type: "tour" },
        { name: "é€é™åœ’", district: "æ–°èˆˆå€", type: "tour" },
        { name: "å…­åˆè§€å…‰å¤œå¸‚", district: "æ–°èˆˆå€", type: "tour" },
        { name: "å¼—é‡‘Â·æ£®(é¸ç‰©)", district: "æ–°èˆˆå€", type: "tour" },

        // å‰é®å€
        { name: "å¹´æ¬½å¾·é‹è²¼", district: "å‰é®å€", type: "food" },
        { name: "è¯å–œçˆŒè‚‰é£¯", district: "å‰é®å€", type: "food" },
        { name: "ç”²ä»™ç¢—ç²¿è‚‰ç²½", district: "å‰é®å€", type: "food" },
        { name: "è±å½©å«©Qä»™è‰", district: "å‰é®å€", type: "food" },
        { name: "è®šè¨˜æ¸¯å¼è„†çš®è‡­è±†è…", district: "å‰é®å€", type: "food" },
        { name: "å…”æ€ç³–æ³•å¼ç”œé»", district: "å‰é®å€", type: "food" },
        { name: "å°å¡‘ç‹æ°æ˜†ä»²å…¬åœ’", district: "å‰é®å€", type: "tour" },
        { name: "å…‰è¯è§€å…‰å¤œå¸‚", district: "å‰é®å€", type: "tour" },
        { name: "é«˜é›„æ™‚ç©ºä¹‹åŸ", district: "å‰é®å€", type: "tour" },
        { name: "é«˜é›„è‰è¡™SKM Park", district: "å‰é®å€", type: "tour" },

        // ä¸‰æ°‘å€
        { name: "é„§å®¶ç²‰åœ“", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "è€å‘¨å†·ç†±é£²", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "é´¨è‚‰å’Œ", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "ä¸Šæµ·ç”Ÿç…æ¹¯åŒ…", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "å°é›…èŒ¶é£²", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "è€ç‰Œè±¬è¡€æ¹¯", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "å‰æ—è’¸é¤ƒ", district: "ä¸‰æ°‘å€", type: "food" },
        { name: "ç§‘å·¥é¤¨", district: "ä¸‰æ°‘å€", type: "tour" },
        { name: "é‡‘ç…æ¹–è´è¶åœ’", district: "ä¸‰æ°‘å€", type: "tour" },
        { name: "å¾Œé©›å•†åœˆ", district: "ä¸‰æ°‘å€", type: "tour" },
        { name: "ä¸­éƒ½æ„›æ²³æ¿•åœ°å…¬åœ’", district: "ä¸‰æ°‘å€", type: "tour" },

        // è‹“é›…å€
        { name: "åšå¾—ç¦æ¹¯åŒ…", district: "è‹“é›…å€", type: "food" },
        { name: "è€åº—æŸå¼˜è‚‰ç‡¥", district: "è‹“é›…å€", type: "food" },
        { name: "è¡Œäº‹ç´…å¿ƒç²‰åœ“", district: "è‹“é›…å€", type: "food" },
        { name: "æ‰“ç‹—é¤…èˆ–", district: "è‹“é›…å€", type: "food" },
        { name: "çŒœå¿ƒæ³¡èŠ™", district: "è‹“é›…å€", type: "food" },
        { name: "è¡›æ­¦è¿·è¿·æ‘", district: "è‹“é›…å€", type: "tour" },

        // é³³å±±å€
        { name: "é«˜è¨˜æ—©é»", district: "é³³å±±å€", type: "food" },
        { name: "é³³é‚‘éºµç·š", district: "é³³å±±å€", type: "food" },
        { name: "æ©‹é‚Šé¦™è…¸æ”¤", district: "é³³å±±å€", type: "food" },
        { name: "æå®¶è‚‰åœ“", district: "é³³å±±å€", type: "food" },
        { name: "æœ¨ä¾–èŠ±ç”Ÿç³–", district: "é³³å±±å€", type: "food" },
        { name: "æ©Ÿå™¨äººä¸»é¡Œå…¬åœ’", district: "é³³å±±å€", type: "tour" },
        { name: "å¿˜æ†‚æ£®æ—", district: "é³³å±±å€", type: "tour" },
        { name: "é³³å„€æ›¸é™¢", district: "é³³å±±å€", type: "tour" },
        { name: "å¤§æ±æ–‡è—ä¸­å¿ƒ", district: "é³³å±±å€", type: "tour" },

        // å°æ¸¯å€
        { name: "è€çˆ¸æ©Ÿå ´å’–å•¡", district: "å°æ¸¯å€", type: "tour" },
    ];

    // --- 1. æ¸²æŸ“æ™¯é»æ±  ---
    const pool = document.getElementById('pool');
    
    function renderPool(filter = 'all') {
        pool.innerHTML = '';
        document.querySelectorAll('.filter-btn').forEach(btn => {
            if(btn.innerText === (filter === 'all' ? 'å…¨éƒ¨' : filter)) btn.classList.add('active');
            else btn.classList.remove('active');
        });

        allSpots.forEach(spot => {
            if (filter !== 'all' && spot.district !== filter) return;
            
            let el = document.createElement('div');
            el.className = `item ${spot.type}`;
            el.setAttribute('data-district', spot.district);
            el.setAttribute('data-name', spot.name);
            el.setAttribute('data-time', '60'); // é è¨­ 60 åˆ†é˜
            
            let tag = (spot.type !== 'trans') ? `<span class="district-tag">[${spot.district.replace('å€','')}]</span>` : '';
            let note = spot.note ? `<small>${spot.note}</small>` : '';
            
            // åŠ å…¥æ™‚é–“æ§åˆ¶å€ (é è¨­éš±è—ï¼Œæ‹–å…¥æ‰é¡¯ç¤º)
            let timeCtrl = `
                <div class="time-ctrl">
                    <button onclick="changeTime(this, -30)">-</button>
                    <span class="time-disp">60m</span>
                    <button onclick="changeTime(this, 30)">+</button>
                </div>
            `;

            el.innerHTML = `
                <div class="content-row">${tag}${spot.name}</div>
                ${note}
                ${timeCtrl}
            `;
            pool.appendChild(el);
        });
    }

    // --- 2. èª¿æ•´æ™‚é–“ (æ–¹å¡Šè®Šå½¢) ---
    window.changeTime = function(btn, delta) {
        let item = btn.closest('.item');
        let current = parseInt(item.getAttribute('data-time'));
        let newVal = current + delta;
        
        if (newVal < 30) newVal = 30; // æœ€å°‘ 30 åˆ†
        if (newVal > 240) newVal = 240; // æœ€å¤š 4 å°æ™‚
        
        item.setAttribute('data-time', newVal);
        item.querySelector('.time-disp').innerText = newVal + 'm';
        
        // è¦–è¦ºé«˜åº¦èª¿æ•´ (åŸºåº• 50px, æ¯ 30 åˆ†é˜ + 30px)
        let baseHeight = 50; 
        if(newVal > 60) {
            item.style.height = (baseHeight + (newVal - 60) * 0.8) + 'px';
        } else {
            item.style.height = 'auto';
        }
    }

    // --- 3. ç”Ÿæˆ 1 å°æ™‚å€é–“çš„æ™‚é–“è»¸ ---
    const scheduleContainer = document.getElementById('schedule-container');
    const startHour = 8;
    const endHour = 22;

    for (let i = startHour; i < endHour; i++) {
        let timeLabel = `${String(i).padStart(2,'0')}:00<br>|<br>${String(i+1).padStart(2,'0')}:00`;
        let slotId = `t${i}`;
        
        let html = `
            <div class="time-slot-container">
                <div class="time-slot">
                    <div class="time-label">${timeLabel}</div>
                    <div class="slot-content">
                        <div class="slot-area" id="${slotId}"></div>
                        <div class="route-hint" id="hint-${slotId}"></div>
                    </div>
                </div>
            </div>
        `;
        scheduleContainer.innerHTML += html;
    }

    // Sortable è¨­å®š
    const config = {
        group: 'shared', animation: 150, delay: 100, delayOnTouchOnly: true,
        onEnd: function (evt) {
            checkRouteLogic(evt.to.id);
            checkRouteLogic(evt.from.id);
        }
    };

    new Sortable(pool, config);
    // ç‚ºæ‰€æœ‰æ™‚é–“æ ¼å¥—ç”¨ Sortable
    for (let i = startHour; i < endHour; i++) {
        new Sortable(document.getElementById(`t${i}`), config);
    }

    // --- 4. è·¯é †åˆ¤æ–· ---
    function checkRouteLogic(slotId) {
        if (!slotId.startsWith('t')) return;
        let slotArea = document.getElementById(slotId);
        let items = slotArea.getElementsByClassName('item');
        let hintBox = document.getElementById(`hint-${slotId}`);
        
        if (items.length === 0) { hintBox.innerHTML = ""; return; }

        let districts = [];
        for(let item of items) {
            let d = item.getAttribute('data-district');
            if(d !== 'äº¤é€š') districts.push(d);
        }
        let unique = [...new Set(districts)];

        if (unique.length > 1) {
            hintBox.innerHTML = `<span class="hint-warn">âš ï¸ è·¨å€: ${unique.join('â‡„')}</span>`;
        } else if (unique.length === 1) {
            hintBox.innerHTML = `<span class="hint-ok">âœ… ${unique[0]}</span>`;
        } else {
            hintBox.innerHTML = "";
        }
    }

    // --- 5. å ±è¡¨ ---
    let answers = { q1: 0, q2: 0 };
    function selectOpt(btn, group, val) {
        let btns = btn.parentNode.getElementsByClassName('btn-opt');
        for (let b of btns) b.classList.remove('active');
        btn.classList.add('active');
        answers[group] = val;
    }

    function generateReport() {
        let name = document.getElementById('username').value.trim();
        if (!name) { alert("è«‹è¼¸å…¥æš±ç¨±ï¼"); return; }
        
        let report = `ã€2/20 é«˜é›„è¡Œç¨‹ - ${name}ã€‘\n------------------\n`;
        
        // éæ­·æ‰€æœ‰æ™‚æ®µ
        for (let i = startHour; i < endHour; i++) {
            let slotId = `t${i}`;
            let area = document.getElementById(slotId);
            let items = area.getElementsByClassName('item');
            
            if(items.length > 0) {
                let timeStr = `${String(i).padStart(2,'0')}:00`;
                let acts = [];
                for(let item of items) {
                    let n = item.getAttribute('data-name');
                    let t = item.getAttribute('data-time');
                    // å¦‚æœåœç•™æ™‚é–“å¤§æ–¼ 60 åˆ†é˜ï¼Œåœ¨æ–‡å­—ä¸Šä¹Ÿå‚™è¨»ä¸€ä¸‹
                    let timeNote = (t > 60) ? `(${Math.floor(t/60)}hr)` : ``;
                    acts.push(`${n}${timeNote}`);
                }
                report += `ğŸ•’ ${timeStr}: ${acts.join(' + ')}\n`;
            }
        }
        
        report += `------------------\nåœ°åœ–: https://bit.ly/KH-Trip-Map`;
        navigator.clipboard.writeText(report).then(() => alert("å·²è¤‡è£½ï¼")).catch(() => alert("è¤‡è£½å¤±æ•—"));
    }

    renderPool();
</script>

</body>
</html>
